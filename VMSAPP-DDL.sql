--DB2 for i DDL for Video Management System app
--CL:CRTLIB VMSAPP; 
--CL:DLTLIB VMSAPP;
CREATE SCHEMA VMSAPP;
--  DROP TABLE VMSAPP.VMSEVENTS;
CREATE TABLE VMSAPP.VMSEVENTS ( 
  "ID" SMALLINT GENERATED ALWAYS AS IDENTITY ( 
	START WITH 1 INCREMENT BY 1 
	NO MINVALUE NO MAXVALUE 
	CYCLE NO ORDER 
	CACHE 20 ) ,
  	OBJECTTYPE VARCHAR(250) CCSID 37 DEFAULT NULL , 
    DETECTION_SCORE NUMERIC(8, 2) DEFAULT NULL , 
    EVENT_TS TIMESTAMP DEFAULT NULL ,
    EVENT_SRC  VARCHAR(250) CCSID 37 DEFAULT NULL , 
    CONSTRAINT VMSAPP.VMSEVENTS_PK PRIMARY KEY( ID ) )  ;
    
alter table vmsapp.vmsevents add column JSON_INFO    BLOB(32K) ;   
 
CL: CHGAUT OBJ('/qsys.lib/VMSAPP.lib/VMSEVENTS.file')  USER(BENOIT) DTAAUT(*RWX);
 
 
    ---JSON INSERT TEST - Prior to 7.5 , use systools
INSERT INTO VMSAPP.VMSEVENTS(OBJECTTYPE, DETECTION_SCORE, EVENT_TS, EVENT_SRC, JSON_INFO) values('person','89.39391374588013',TIMESTAMP_FORMAT('2023-05-15 15:28:19.608', 'YYYY-MM-DD HH24:MI:SS.FF3'),'Camera1', SYSTOOLS.JSON2BSON('{
 "data": [  {  "id": "file.22688711f5410e6c.22688711F5410E6C!942" }]}' ));
  --- with IBM i 7.5
 INSERT INTO VMSAPP.VMSEVENTS(OBJECTTYPE, DETECTION_SCORE, EVENT_TS, EVENT_SRC, JSON_INFO) values('person','89.39391374588013',TIMESTAMP_FORMAT('2023-05-15 15:28:19.608', 'YYYY-MM-DD HH24:MI:SS.FF3'),'Camera1', JSON_TO_BSON('{
 "data": [  {  "id": "file.22688711f5410e6c.22688711F5410E6C!942" }]}' ));
 

 SELECT * FROM VMSAPP.VMSEVENTS ORDER BY ID DESC;
